{"version":3,"file":"create-offer.js","sourceRoot":"","sources":["../../src/elements/create-offer.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, property, query } from 'lit-element';\n\nimport { TextField } from 'scoped-material-components/mwc-textfield';\nimport { Button } from 'scoped-material-components/mwc-button';\nimport { Dialog } from 'scoped-material-components/mwc-dialog';\nimport { AgentProfile, SearchAgent } from '@holochain-open-dev/profiles';\n\nimport { sharedStyles } from './utils/shared-styles';\nimport { Card } from 'scoped-material-components/mwc-card';\nimport { connectStore, StoreElement } from '@holochain-open-dev/common';\nimport { TransactorStore } from '../transactor.store';\n\nexport abstract class CreateOffer extends StoreElement<TransactorStore> {\n  /** Private properties */\n\n  @query('#amount')\n  _amountField!: TextField;\n\n  @query('#dialog')\n  _dialog!: Dialog;\n\n  @property({ type: Object })\n  _recipientAgentProfile: AgentProfile | undefined = undefined;\n\n  static styles = sharedStyles;\n\n  firstUpdated() {\n    this._amountField.validityTransform = newValue => {\n      this.requestUpdate();\n      try {\n        const amount = parseFloat(newValue);\n        if (amount > 0) return { valid: true };\n      } catch (e) {}\n      this._amountField.setCustomValidity(\n        `Offer amount has to be greater than 0`\n      );\n      return {\n        valid: false,\n      };\n    };\n  }\n\n  async createOffer() {\n    const recipientPubKey = this._recipientAgentProfile\n      ?.agent_pub_key as string;\n    const amount = parseFloat(this._amountField.value);\n\n    await this.store.createOffer(recipientPubKey, amount);\n\n    this.dispatchEvent(\n      new CustomEvent('offer-created', {\n        detail: { recipientPubKey, amount },\n        composed: true,\n        bubbles: true,\n      })\n    );\n  }\n\n  renderConfirmDialog() {\n    return html`\n      <mwc-dialog heading=\"Confirm offer\" id=\"dialog\">\n        <span>\n          You are about to create an offer to\n          ${this._recipientAgentProfile?.profile.nickname}, with public key\n          ${this._recipientAgentProfile?.agent_pub_key}. This would lower your\n          balance by the amount of the transaction and raise the recipient's\n          value by the same amount.\n        </span>\n\n        <mwc-button slot=\"secondaryAction\" dialogAction=\"cancel\">\n          Cancel\n        </mwc-button>\n        <mwc-button\n          .disabled=${!this._amountField || !this._amountField.validity.valid}\n          slot=\"primaryAction\"\n          @click=${() => this.createOffer()}\n          dialogAction=\"create\"\n        >\n          Confirm\n        </mwc-button>\n      </mwc-dialog>\n    `;\n  }\n\n  onAgentSelected(e: CustomEvent) {\n    this._recipientAgentProfile = e.detail.agent;\n  }\n\n  render() {\n    return html`\n      ${this.renderConfirmDialog()}\n      <mwc-card style=\"width: auto; flex: 1;\">\n        <div class=\"column\" style=\"margin: 16px;\">\n          <span class=\"title\" style=\"margin-bottom: 8px;\"\n            >Create New Offer</span\n          >\n          <search-agent\n            field-label=\"Recipient\"\n            @agent-selected=${(e: CustomEvent) => this.onAgentSelected(e)}\n          ></search-agent>\n\n          <mwc-textfield\n            style=\"padding-top: 16px; margin-bottom: 16px;\"\n            label=\"Amount\"\n            type=\"number\"\n            id=\"amount\"\n            min=\"0.1\"\n            step=\"0.1\"\n            autoValidate\n            outlined\n          ></mwc-textfield>\n\n          <mwc-button\n            label=\"CREATE OFFER\"\n            .disabled=${!(\n              this._recipientAgentProfile && this._amountField.value\n            )}\n            @click=${() => this._dialog.show()}\n          ></mwc-button>\n        </div>\n      </mwc-card>\n    `;\n  }\n\n  getScopedElements() {\n    return {\n      'mwc-textfield': TextField,\n      'mwc-card': Card,\n      'mwc-button': Button,\n      'mwc-dialog': Dialog,\n      'search-agent': connectStore(SearchAgent, this.store.profilesStore),\n    };\n  }\n}\n"]}